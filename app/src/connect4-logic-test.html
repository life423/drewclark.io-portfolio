<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect4 Logic Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #1a1a1a;
            color: white;
            padding: 20px;
        }
        
        h1, h2 {
            text-align: center;
            color: #10b981;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #222;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .board-container {
            margin: 20px 0;
            padding: 10px;
            background-color: #333;
            border-radius: 4px;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        
        .success {
            background-color: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
        }
        
        .failure {
            background-color: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
        }
        
        pre {
            white-space: pre-wrap;
            background-color: #2d2d2d;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        
        button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #10b981;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #059669;
        }
        
        .board-visualization {
            display: grid;
            grid-template-columns: repeat(7, 40px);
            gap: 5px;
            margin: 20px auto;
            background: #0066cc;
            padding: 10px;
            border-radius: 4px;
            width: fit-content;
        }
        
        .cell {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #aaa;
        }
        
        .cell.player {
            background-color: #ff3333;
        }
        
        .cell.ai {
            background-color: #ffff33;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Connect4 Logic Test</h1>
        
        <div id="output"></div>
        
        <button id="run-tests">Run Tests</button>
    </div>
    
    <script type="module">
        // Import the fixed connect4Logic module
        import * as gameLogic from './components/games/connect4/connect4Logic.js';
        
        const output = document.getElementById('output');
        const runTestsButton = document.getElementById('run-tests');
        
        function logResult(title, result, expected, details = "") {
            const resultElement = document.createElement('div');
            resultElement.className = `test-result ${result === expected ? 'success' : 'failure'}`;
            
            resultElement.innerHTML = `
                <h3>${title}</h3>
                <p><strong>Result:</strong> ${result}</p>
                <p><strong>Expected:</strong> ${expected}</p>
                ${details ? `<p><strong>Details:</strong></p><pre>${details}</pre>` : ''}
            `;
            
            output.appendChild(resultElement);
            return result === expected;
        }
        
        function visualizeBoard(board, containerElement) {
            const boardElement = document.createElement('div');
            boardElement.className = 'board-visualization';
            
            // We need to reverse the board to display it correctly (row 0 at the bottom)
            const displayBoard = [...board].reverse();
            
            displayBoard.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const cellElement = document.createElement('div');
                    cellElement.className = 'cell';
                    cellElement.textContent = `${5 - rowIndex},${colIndex}`;
                    
                    if (cell === gameLogic.PLAYER) {
                        cellElement.classList.add('player');
                    } else if (cell === gameLogic.AI) {
                        cellElement.classList.add('ai');
                    }
                    
                    boardElement.appendChild(cellElement);
                });
            });
            
            containerElement.appendChild(boardElement);
        }
        
        function testIsValidMove() {
            let passed = true;
            const testSection = document.createElement('div');
            testSection.className = 'board-container';
            testSection.innerHTML = '<h2>Testing isValidMove</h2>';
            output.appendChild(testSection);
            
            // Test 1: Empty board, all moves should be valid
            const emptyBoard = gameLogic.createEmptyBoard();
            let allValid = true;
            
            for (let col = 0; col < gameLogic.COLS; col++) {
                const isValid = gameLogic.isValidMove(emptyBoard, col);
                if (!isValid) {
                    allValid = false;
                    break;
                }
            }
            
            passed = logResult('Test 1: All columns valid on empty board', allValid, true) && passed;
            visualizeBoard(emptyBoard, testSection);
            
            // Test 2: Bottom row filled, all columns should still be valid
            const bottomRowFilledBoard = gameLogic.createEmptyBoard();
            for (let col = 0; col < gameLogic.COLS; col++) {
                bottomRowFilledBoard[gameLogic.ROWS - 1][col] = gameLogic.PLAYER;
            }
            
            allValid = true;
            for (let col = 0; col < gameLogic.COLS; col++) {
                const isValid = gameLogic.isValidMove(bottomRowFilledBoard, col);
                if (!isValid) {
                    allValid = false;
                    break;
                }
            }
            
            passed = logResult('Test 2: All columns valid with bottom row filled', allValid, true) && passed;
            visualizeBoard(bottomRowFilledBoard, testSection);
            
            // Test 3: One column filled, all other columns should be valid
            const oneColumnFilledBoard = gameLogic.createEmptyBoard();
            for (let row = 0; row < gameLogic.ROWS; row++) {
                oneColumnFilledBoard[row][3] = gameLogic.PLAYER; // Fill middle column
            }
            
            const test3Results = [];
            for (let col = 0; col < gameLogic.COLS; col++) {
                const isValid = gameLogic.isValidMove(oneColumnFilledBoard, col);
                test3Results.push(`Column ${col}: ${isValid}`);
                
                // Column 3 should be invalid, all others valid
                if ((col === 3 && isValid) || (col !== 3 && !isValid)) {
                    allValid = false;
                }
            }
            
            passed = logResult('Test 3: All columns valid except filled column', allValid, true, test3Results.join('\n')) && passed;
            visualizeBoard(oneColumnFilledBoard, testSection);
            
            return passed;
        }
        
        function testDropDisc() {
            let passed = true;
            const testSection = document.createElement('div');
            testSection.className = 'board-container';
            testSection.innerHTML = '<h2>Testing dropDisc</h2>';
            output.appendChild(testSection);
            
            // Test 1: Drop a disc into an empty column
            const board1 = gameLogic.createEmptyBoard();
            const { board: newBoard1, row: row1 } = gameLogic.dropDisc(board1, 3, gameLogic.PLAYER);
            
            const test1Result = (row1 === gameLogic.ROWS - 1) && (newBoard1[gameLogic.ROWS - 1][3] === gameLogic.PLAYER);
            passed = logResult('Test 1: Disc drops to bottom of empty column', test1Result, true) && passed;
            visualizeBoard(newBoard1, testSection);
            
            // Test 2: Drop another disc on top of the first one
            const { board: newBoard2, row: row2 } = gameLogic.dropDisc(newBoard1, 3, gameLogic.AI);
            
            const test2Result = (row2 === gameLogic.ROWS - 2) && (newBoard2[gameLogic.ROWS - 2][3] === gameLogic.AI);
            passed = logResult('Test 2: Disc stacks on top of existing disc', test2Result, true) && passed;
            visualizeBoard(newBoard2, testSection);
            
            // Test 3: Fill a column and try to drop another disc
            let board3 = gameLogic.createEmptyBoard();
            
            // Fill column 3
            for (let i = 0; i < gameLogic.ROWS; i++) {
                const result = gameLogic.dropDisc(board3, 3, gameLogic.PLAYER);
                board3 = result.board;
            }
            
            visualizeBoard(board3, testSection);
            
            // Try to drop another disc in the full column
            const { board: newBoard3, row: row3 } = gameLogic.dropDisc(board3, 3, gameLogic.AI);
            
            // Should return -1 for row and the board should be unchanged
            const test3Result = (row3 === -1) && (JSON.stringify(newBoard3) === JSON.stringify(board3));
            passed = logResult('Test 3: Cannot drop disc in full column', test3Result, true) && passed;
            
            return passed;
        }
        
        function runAllTests() {
            output.innerHTML = '';
            
            const isValidMoveTestPassed = testIsValidMove();
            const dropDiscTestPassed = testDropDisc();
            
            const summary = document.createElement('div');
            summary.innerHTML = `
                <h2>Test Summary</h2>
                <ul>
                    <li>isValidMove tests: ${isValidMoveTestPassed ? '✅ PASSED' : '❌ FAILED'}</li>
                    <li>dropDisc tests: ${dropDiscTestPassed ? '✅ PASSED' : '❌ FAILED'}</li>
                    <li>Overall: ${isValidMoveTestPassed && dropDiscTestPassed ? '✅ PASSED' : '❌ FAILED'}</li>
                </ul>
            `;
            output.appendChild(summary);
        }
        
        runTestsButton.addEventListener('click', runAllTests);
        
        // Auto-run tests
        setTimeout(runAllTests, 500);
    </script>
</body>
</html>
