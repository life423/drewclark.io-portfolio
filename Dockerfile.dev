FROM node:18-alpine
WORKDIR /app

# Install dependencies
COPY package.json ./
COPY app/package*.json ./app/
RUN npm install && \
    cd app && npm install && cd ..

# Copy code (will be overridden by volumes in dev)
COPY . .

# Expose port
EXPOSE 3000

# Set environment variables
ENV NODE_ENV=development

# Install nodemon for development
RUN npm install -g nodemon

# Command for development with hot reloading
CMD ["nodemon", "--watch", "server.js", "--watch", "api", "server.js"]
