# Development Dockerfile with improved caching
FROM node:18-alpine
WORKDIR /app

# Install dependencies in separate layers for better caching
COPY package.json ./
RUN npm install

# Install app dependencies
COPY app/package*.json ./app/
RUN cd app && npm install && cd ..

# Copy server and API files (will be overridden by volumes in dev)
# This is needed for initial container build
COPY server.js ./
COPY api/ ./api/
COPY app/ ./app/

# Expose port
EXPOSE 3000

# Set environment variables
ENV NODE_ENV=development

# Install nodemon for development
RUN npm install -g nodemon

# Command for development with hot reloading
# Watch API directory and server.js for changes
CMD ["nodemon", "--watch", "server.js", "--watch", "api", "server.js"]
